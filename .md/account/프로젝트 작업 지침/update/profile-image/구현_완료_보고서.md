# 프로필 이미지 업로드 기능 구현 완료 보고서

**작성일**: 2025년 11월 29일
**작성자**: GitHub Copilot
**상태**: 완료

## 1. 개요
사용자 프로필의 개인화 및 식별 편의성을 높이기 위해 **프로필 이미지 업로드 및 관리 기능**을 구현했습니다. 이 기능은 사용자가 자신의 프로필 사진을 등록, 수정할 수 있게 하며, 프론트엔드와 백엔드 간의 파일 전송 및 데이터 동기화를 포함합니다.

## 2. 기능 시나리오 (User Flow)

### 2.1 프로필 이미지 등록/수정
1.  **진입**: 사용자가 마이페이지의 '프로필 수정' 버튼을 클릭하여 모달 창을 엽니다.
2.  **이미지 선택**:
    *   현재 프로필 이미지가 표시된 영역(또는 기본 이니셜 아바타)을 클릭합니다.
    *   파일 탐색기가 열리면 업로드할 이미지 파일(jpg, png 등)을 선택합니다.
3.  **즉시 업로드 (비동기)**:
    *   파일을 선택하는 즉시 프론트엔드에서 백엔드 API (`POST /api/files/upload`)로 파일을 전송합니다.
    *   백엔드는 S3에 파일을 저장하고, 저장된 파일의 **URL**을 반환합니다.
4.  **미리보기**:
    *   프론트엔드는 반환받은 URL을 사용하여 모달 창의 프로필 이미지를 즉시 업데이트하여 보여줍니다. (아직 최종 저장은 아님)
5.  **최종 저장**:
    *   사용자가 모달의 '저장' 버튼을 클릭합니다.
    *   프론트엔드는 변경된 이미지 URL을 포함한 프로필 정보를 백엔드 API (`PATCH /api/mypage/profile`)로 전송합니다.
    *   백엔드는 DB의 `Account` 테이블에 이미지 URL을 업데이트합니다.
6.  **반영**:
    *   마이페이지 및 사이드바의 프로필 이미지가 새 이미지로 변경됩니다.

### 2.2 프로필 이미지 조회
1.  **로그인/접속**: 사용자가 로그인하거나 마이페이지에 접속합니다.
2.  **데이터 로드**: 프론트엔드가 백엔드 API (`GET /api/mypage/profile`)를 호출합니다.
3.  **렌더링**:
    *   응답 데이터에 `profileImage` URL이 있으면 해당 이미지를 표시합니다.
    *   URL이 없으면(null) 사용자의 이름 첫 글자를 딴 기본 이니셜 아바타를 표시합니다.

---

## 3. 구현 상세

### 3.1 Backend
*   **Entity**: `Account` 엔티티에 `profileImage` (String) 컬럼 추가.
*   **DTO**:
    *   `AccountResponse`: 클라이언트로 이미지 URL 전달 필드 추가.
    *   `UpdateProfileRequest`: 클라이언트로부터 이미지 URL 수신 필드 추가.
*   **Service**: `ProfileServiceImpl`에서 프로필 수정 시 이미지 URL 업데이트 로직 추가.
*   **API**:
    *   `POST /api/files/upload`: 파일 업로드 처리 (기존 공통 파일 업로드 API 활용, `folder=profile` 파라미터 사용).
    *   `PATCH /api/mypage/profile`: 프로필 정보(이미지 URL 포함) 수정 처리.

### 3.2 Frontend
*   **UI**:
    *   `EditProfileModal`: 이미지 클릭 이벤트, 파일 입력(`input type="file"`), 업로드 중 로딩 인디케이터, 미리보기 UI 구현.
    *   `Sidebar`: 프로필 이미지 유무에 따른 조건부 렌더링 (이미지 vs 이니셜).
*   **Service**:
    *   `uploadFile`: `FormData`를 생성하여 파일 업로드 API 호출.
    *   `updateProfile`: 이미지 URL을 포함하여 프로필 수정 API 호출.

## 4. 데이터베이스 변경 사항
```sql
ALTER TABLE account ADD COLUMN profile_image VARCHAR(255);
```
(JPA `ddl-auto=update` 설정에 의해 자동 반영됨)

## 5. 향후 개선 사항
*   **이미지 삭제**: 프로필 이미지를 기본값으로 되돌리는(삭제) 기능 추가 고려.
*   **이미지 최적화**: 업로드 시 서버 또는 클라이언트에서 이미지 리사이징/압축 적용.
*   **기존 파일 정리**: 프로필 이미지를 변경할 때, S3에 남아있는 기존 이미지를 삭제하는 로직 추가 (스토리지 비용 절감).
