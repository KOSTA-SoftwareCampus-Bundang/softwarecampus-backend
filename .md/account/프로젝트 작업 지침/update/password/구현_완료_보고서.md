# 비밀번호 관리 기능 구현 완료 보고서

> 작성일: 2025-11-29  
> 최종 수정: 2025-11-30  
> 브랜치: `account-update-v2`

---

## 1. 구현 요약

### 1.1 비밀번호 변경 (로그인 상태 - 마이페이지)

| 항목 | 상태 | 비고 |
|------|------|------|
| VerifyPasswordRequest/Response DTO | ✅ 완료 | 현재 비밀번호 검증용 |
| ResetPasswordRequest DTO | ✅ 완료 | 신규 생성 |
| AuthController.verifyPassword() | ✅ 완료 | Step 1: 현재 비밀번호 확인 |
| EmailVerificationController.sendChangeCode() | ✅ 완료 | Step 2: 인증 코드 발송 |
| ProfileService.changePassword() | ✅ 완료 | Step 3: 비밀번호 변경 |
| 프론트엔드 ChangePasswordModal | ✅ 완료 | 3단계 UI 구현 |

### 1.2 비밀번호 찾기 (비로그인 상태 - 로그인 페이지)

| 항목 | 상태 | 비고 |
|------|------|------|
| EmailVerificationController.sendResetCode() | ✅ 완료 | 인증 코드 발송 |
| EmailVerificationController.verifyResetCode() | ✅ 완료 | 인증 코드 확인 |
| AuthController.resetPassword() | ✅ 완료 | 비밀번호 재설정 |
| 프론트엔드 ForgotPasswordPage | ✅ 완료 | 3단계 UI 구현 |
| 이메일 템플릿 | ✅ 완료 | password-reset-verification.html |

---

## 2. 파일 변경 내역

### 2.1 백엔드 - 신규 생성
```
src/main/java/com/softwarecampus/backend/dto/user/ResetPasswordRequest.java
src/main/java/com/softwarecampus/backend/dto/user/VerifyPasswordRequest.java
src/main/java/com/softwarecampus/backend/dto/user/VerifyPasswordResponse.java
src/main/resources/templates/email/password-reset-verification.html
src/main/resources/templates/email/password-change-verification.html
```

### 2.2 백엔드 - 수정
```
src/main/java/com/softwarecampus/backend/controller/user/AuthController.java
src/main/java/com/softwarecampus/backend/controller/user/EmailVerificationController.java
src/main/java/com/softwarecampus/backend/controller/user/MyPageController.java
src/main/java/com/softwarecampus/backend/service/user/profile/ProfileService.java
src/main/java/com/softwarecampus/backend/service/user/profile/ProfileServiceImpl.java
src/main/java/com/softwarecampus/backend/service/auth/EmailVerificationService.java
```

### 2.3 프론트엔드 - 신규 생성
```
src/pages/ForgotPasswordPage.tsx
```

### 2.4 프론트엔드 - 수정
```
src/App.tsx (라우트 추가)
src/pages/LoginPage.tsx (비밀번호 찾기 링크 추가)
src/pages/MyPage/components/modals/ChangePasswordModal.tsx
src/services/authService.ts
```

---

## 3. API 스펙

### 3.1 비밀번호 변경 (로그인 상태) - 이중 인증

#### Step 1: 현재 비밀번호 확인
```
POST /api/auth/verify-password
Authorization: Bearer {accessToken}
```
**Request**
```json
{
  "currentPassword": "현재비밀번호"
}
```
**Response**
```json
{
  "verified": true,
  "message": "비밀번호가 확인되었습니다."
}
```

#### Step 2: 이메일 인증 코드 발송
```
POST /api/auth/email/send-change-code
Authorization: Bearer {accessToken}
```
**Request**
```json
{
  "email": "user@example.com"
}
```

#### Step 3: 비밀번호 변경
```
PUT /api/mypage/password
Authorization: Bearer {accessToken}
```
**Request**
```json
{
  "code": "123456",
  "newPassword": "NewPass123!"
}
```

### 3.2 비밀번호 찾기 (비로그인 상태)

#### Step 1: 인증 코드 발송
```
POST /api/auth/email/send-reset-code
```
**Request**
```json
{
  "email": "user@example.com"
}
```

#### Step 2: 인증 코드 확인
```
POST /api/auth/email/verify-reset
```
**Request**
```json
{
  "email": "user@example.com",
  "code": "123456"
}
```

#### Step 3: 비밀번호 재설정
```
POST /api/auth/reset-password
```
**Request**
```json
{
  "email": "user@example.com",
  "code": "123456",
  "newPassword": "NewPass123!"
}
```

---

## 4. 인증 타입 구분

| 타입 | 용도 | 발송 API | 검증 메서드 |
|------|------|----------|-------------|
| `SIGNUP` | 회원가입 이메일 인증 | send-verification | verifyCode() |
| `PASSWORD_RESET` | 비밀번호 찾기 (비로그인) | send-reset-code | verifyResetCode() |
| `PASSWORD_CHANGE` | 비밀번호 변경 (로그인) | send-change-code | verifyChangeCode() |

---

## 5. 흐름도

### 5.1 비밀번호 변경 (로그인 상태)
```
[마이페이지]                         [백엔드]
     │
     │ 1. 현재 비밀번호 입력
     ├──────────────────────────────► POST /api/auth/verify-password
     │                                ✓ 본인 확인
     │
     │ 2. "이메일 인증" 클릭
     ├──────────────────────────────► POST /api/auth/email/send-change-code
     │                                → 이메일로 6자리 코드 발송
     │
     │ 3. 인증코드 + 새 비밀번호 입력
     ├──────────────────────────────► PUT /api/mypage/password
     │                                ✓ PASSWORD_CHANGE 타입 검증
     │                                ✓ 비밀번호 변경
     │
     │ 4. 200 OK (완료)
     ◄──────────────────────────────┤
```

### 5.2 비밀번호 찾기 (비로그인 상태)
```
[로그인 페이지]                       [백엔드]
     │
     │ 1. 이메일 입력
     ├──────────────────────────────► POST /api/auth/email/send-reset-code
     │                                → 이메일로 6자리 코드 발송
     │
     │ 2. 인증 코드 입력
     ├──────────────────────────────► POST /api/auth/email/verify-reset
     │                                ✓ PASSWORD_RESET 타입 검증
     │
     │ 3. 새 비밀번호 입력
     ├──────────────────────────────► POST /api/auth/reset-password
     │                                ✓ 비밀번호 재설정
     │
     │ 4. 200 OK → 로그인 페이지로 이동
     ◄──────────────────────────────┤
```

---

## 6. 보안 정책

| 항목 | 정책 |
|------|------|
| 인증 코드 유효 시간 | 3분 |
| 인증 시도 제한 | 5회 실패 시 30분 차단 |
| 비밀번호 규칙 | 8~20자, 영문+숫자+특수문자 필수 |
| 코드 재발송 | 이전 코드 무효화 |

---

## 7. 프론트엔드 페이지

### 7.1 비밀번호 찾기 페이지
- **경로**: `/forgot-password`
- **컴포넌트**: `ForgotPasswordPage.tsx`
- **단계**:
  1. 이메일 입력 → 인증 코드 발송
  2. 인증 코드 입력 → 확인
  3. 새 비밀번호 설정
  4. 완료 → 로그인 페이지로 이동

### 7.2 비밀번호 변경 모달 (마이페이지)
- **컴포넌트**: `ChangePasswordModal.tsx`
- **단계**:
  1. 현재 비밀번호 입력 → "이메일 인증" 버튼
  2. 인증 코드 입력
  3. 새 비밀번호 설정
  4. 완료

---

## 8. 완료 상태

- ✅ 백엔드 API 구현
- ✅ 프론트엔드 UI 구현
- ✅ 이메일 템플릿 작성
- ✅ 라우팅 설정
- ✅ 컴파일 성공
- ⏳ 통합 테스트 진행 중
