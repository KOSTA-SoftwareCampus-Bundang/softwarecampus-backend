# 비밀번호 재설정 API 구현 완료 보고서

> 작성일: 2025-11-29  
> 브랜치: `account-update`

---

## 1. 구현 요약

| 항목 | 상태 | 비고 |
|------|------|------|
| ResetPasswordRequest DTO | ✅ 완료 | 신규 생성 |
| ProfileService.resetPassword() | ✅ 완료 | EmailVerificationService 재사용 |
| MyPageController PUT /password | ✅ 완료 | 엔드포인트 추가 |
| 단위 테스트 | ⏳ 대기 | S3Service 오류 해결 후 진행 |

---

## 2. 파일 변경 내역

### 2.1 신규 생성
```
src/main/java/com/softwarecampus/backend/dto/user/ResetPasswordRequest.java
```

### 2.2 수정
```
src/main/java/com/softwarecampus/backend/service/user/profile/ProfileService.java
src/main/java/com/softwarecampus/backend/service/user/profile/ProfileServiceImpl.java
src/main/java/com/softwarecampus/backend/controller/user/MyPageController.java
```

---

## 3. API 스펙

### PUT /api/mypage/password

**Request**
```json
{
  "code": "123456",
  "newPassword": "NewPass123!"
}
```

**Response**
- `200 OK`: 비밀번호 변경 성공
- `400 Bad Request`: 인증 코드 불일치/만료, 비밀번호 규칙 위반
- `404 Not Found`: 계정 없음
- `429 Too Many Requests`: 인증 시도 횟수 초과 (5회 실패 시 30분 차단)

---

## 4. 재사용 구조

### 4.1 EmailVerificationService 재사용 ✅
기존 SMTP 인증 코드 검증 로직을 그대로 활용:

```java
// ProfileServiceImpl.resetPassword()
EmailVerificationCodeRequest codeRequest = new EmailVerificationCodeRequest(email, request.getCode());
emailVerificationService.verifyResetCode(codeRequest);  // 재사용!
```

**재사용되는 기능:**
- 차단 상태 확인 (5회 실패 → 30분 차단)
- 코드 만료 확인 (3분 유효)
- 코드 일치 검증
- 시도 횟수 관리

### 4.2 비밀번호 정규식 (중복 허용)
`SignupRequest`와 `ResetPasswordRequest`에 동일한 정규식 사용:

```java
// 두 DTO에 동일하게 적용
@Pattern(
    regexp = "^(?=.*[A-Za-z])(?=.*\\d)(?=.*[!@#$%^&*()\\-_=+\\[\\]{}|;:'\",.<>/?~])...",
    message = "비밀번호는 영문, 숫자, 특수문자를 포함해야 합니다"
)
```

**중복 허용 결정 이유:**
- DTO는 독립적인 단위
- 변경 빈도가 낮음
- 2곳뿐이라 관리 부담 적음
- 상수 파일 생성 불필요

---

## 5. 흐름도

```
[프론트엔드]                         [백엔드]
     │
     │ 1. 인증 코드 요청
     ├──────────────────────────────► POST /api/auth/email/send
     │                                (type: PASSWORD_RESET)
     │ 2. 이메일로 6자리 코드 수신
     │
     │ 3. 코드 + 새 비밀번호 입력
     ├──────────────────────────────► PUT /api/mypage/password
     │                                {code, newPassword}
     │
     │                                ┌─ EmailVerificationService.verifyResetCode()
     │                                │   - 차단 확인
     │                                │   - 만료 확인
     │                                │   - 코드 검증
     │                                ├─ PasswordEncoder.encode()
     │                                ├─ Account.setPassword()
     │                                └─ 인증 레코드 삭제
     │
     │ 4. 200 OK
     ◄──────────────────────────────┤
```

---

## 6. 보류 사항

### S3Service 컴파일 오류
```
cannot find symbol: class GetObjectPresignRequest
location: S3Service.java:156
```
- **원인**: 다른 팀원 작업 중 import 누락 또는 의존성 문제
- **영향**: 전체 컴파일 불가
- **조치**: 해당 팀원에게 전달 필요

---

## 7. 다음 단계

1. S3Service 오류 해결 (담당자 확인)
2. 컴파일 성공 후 단위 테스트 작성
3. 통합 테스트 진행
4. 프론트엔드 연동 테스트
