# ë¹„ë°€ë²ˆí˜¸ ê´€ë¦¬ ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ ë³´ê³ ì„œ

> ì‘ì„±ì¼: 2025-11-29  
> ìµœì¢… ìˆ˜ì •: 2025-12-01  
> ë¸Œëœì¹˜: `account-update-v2` â†’ `account-update-v3` (ë³´ì•ˆ ê°•í™”)

---

## ğŸ“¢ v3 ì—…ë°ì´íŠ¸ (2025-12-01)

### ì¶”ê°€ëœ ë³´ì•ˆ ê°•í™” ì‚¬í•­
1. âœ… **Rate Limiting êµ¬í˜„** (Redis ê¸°ë°˜)
   - ë¹„ë°€ë²ˆí˜¸ ê²€ì¦: 10 req/min per (IP + username)
   - ë¡œê·¸ì¸: 5 req/min per IP
   - ì „ì—­ API: 100 req/min per IP
   
2. âœ… **ì •ë³´ ëˆ„ì¶œ ë°©ì§€**
   - ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ì‘ë‹µ í†µì¼ (ëª¨ë“  ì‹¤íŒ¨ â†’ 200 OK + failure())
   - ìŠ¹ì¸ ìƒíƒœ ì •ë³´ ìˆ¨ê¹€ (ì¼ê´€ëœ ë©”ì‹œì§€)
   
3. âœ… **API ê³„ì•½ ë³µì›**
   - `changePassword`ì—ì„œ `ChangePasswordRequest` ì‚¬ìš© (ResetPasswordRequest ì œê±°)
   - PUT /password ë‹¨ì¼ ì—”ë“œí¬ì¸íŠ¸ ìœ ì§€ (ì¤‘ë³µ ì œê±°)
   
4. âœ… **Soft Delete ì •ì±… ì¼ê´€ì„±**
   - ì´ë©”ì¼/ì „í™”ë²ˆí˜¸/ì‚¬ìš©ìëª… ëª¨ë‘ ì¬ì‚¬ìš© ê°€ëŠ¥
   - Repository ë©”ì„œë“œ: `existsByEmailAndIsDeletedFalse` ë“±

**ê´€ë ¨ ë¬¸ì„œ**: `.md/account/ì‘ì—… ê¸°ë¡/account-update-v3-security-improvements.md`

---

## 1. êµ¬í˜„ ìš”ì•½

### 1.1 ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ë¡œê·¸ì¸ ìƒíƒœ - ë§ˆì´í˜ì´ì§€)

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| VerifyPasswordRequest/Response DTO | âœ… ì™„ë£Œ | í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ìš© |
| ChangePasswordRequest DTO | âœ… ì™„ë£Œ | v3ì—ì„œ ë³µì› (ì´ì „ ResetPasswordRequest ì œê±°) |
| AuthController.verifyPassword() | âœ… ì™„ë£Œ | Step 1: í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ + Rate Limiting |
| EmailVerificationController.sendChangeCode() | âœ… ì™„ë£Œ | Step 2: ì¸ì¦ ì½”ë“œ ë°œì†¡ |
| ProfileService.changePassword() | âœ… ì™„ë£Œ | Step 3: ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ChangePasswordRequest ì‚¬ìš©) |
| MyPageController | âœ… ì™„ë£Œ | PUT /password ë‹¨ì¼ ì—”ë“œí¬ì¸íŠ¸ (ì¤‘ë³µ ì œê±°) |
| í”„ë¡ íŠ¸ì—”ë“œ ChangePasswordModal | âœ… ì™„ë£Œ | 3ë‹¨ê³„ UI êµ¬í˜„ |

### 1.2 ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° (ë¹„ë¡œê·¸ì¸ ìƒíƒœ - ë¡œê·¸ì¸ í˜ì´ì§€)

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| EmailVerificationController.sendResetCode() | âœ… ì™„ë£Œ | ì¸ì¦ ì½”ë“œ ë°œì†¡ |
| EmailVerificationController.verifyResetCode() | âœ… ì™„ë£Œ | ì¸ì¦ ì½”ë“œ í™•ì¸ |
| AuthController.resetPassword() | âœ… ì™„ë£Œ | ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • |
| í”„ë¡ íŠ¸ì—”ë“œ ForgotPasswordPage | âœ… ì™„ë£Œ | 3ë‹¨ê³„ UI êµ¬í˜„ |
| ì´ë©”ì¼ í…œí”Œë¦¿ | âœ… ì™„ë£Œ | password-reset-verification.html |

---

## 2. íŒŒì¼ ë³€ê²½ ë‚´ì—­

### 2.1 ë°±ì—”ë“œ - ì‹ ê·œ ìƒì„±
```
src/main/java/com/softwarecampus/backend/dto/user/ChangePasswordRequest.java (v3 ë³µì›)
src/main/java/com/softwarecampus/backend/dto/user/ResetPasswordRequest.java
src/main/java/com/softwarecampus/backend/dto/user/VerifyPasswordRequest.java
src/main/java/com/softwarecampus/backend/dto/user/VerifyPasswordResponse.java
src/main/resources/templates/email/password-reset-verification.html
src/main/resources/templates/email/password-change-verification.html
```

### 2.2 ë°±ì—”ë“œ - ìˆ˜ì •
```
src/main/java/com/softwarecampus/backend/controller/user/AuthController.java
  - verifyPassword(): Rate Limiting ì¶”ê°€ (10 req/min per IP+username)
  - ì‘ë‹µ í†µì¼: ëª¨ë“  ì‹¤íŒ¨ â†’ 200 OK + failure()

src/main/java/com/softwarecampus/backend/controller/user/EmailVerificationController.java
src/main/java/com/softwarecampus/backend/controller/user/MyPageController.java
  - PUT /password ë‹¨ì¼ ì—”ë“œí¬ì¸íŠ¸ ìœ ì§€ (ì¤‘ë³µ PATCH ì œê±°)

src/main/java/com/softwarecampus/backend/service/user/profile/ProfileService.java
src/main/java/com/softwarecampus/backend/service/user/profile/ProfileServiceImpl.java
  - changePassword(): ChangePasswordRequest ì‚¬ìš© (v3 ë³µì›)
  - resetPassword(): ResetPasswordRequest ì‚¬ìš© (êµ¬ë¶„ ëª…í™•í™”)

src/main/java/com/softwarecampus/backend/service/auth/EmailVerificationService.java
src/main/java/com/softwarecampus/backend/security/RateLimitFilter.java (v3 ì¶”ê°€)
  - ì—”ë“œí¬ì¸íŠ¸ë³„ Rate Limiting êµ¬í˜„
```

### 2.3 í”„ë¡ íŠ¸ì—”ë“œ - ì‹ ê·œ ìƒì„±
```
src/pages/ForgotPasswordPage.tsx
```

### 2.4 í”„ë¡ íŠ¸ì—”ë“œ - ìˆ˜ì •
```
src/App.tsx (ë¼ìš°íŠ¸ ì¶”ê°€)
src/pages/LoginPage.tsx (ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ë§í¬ ì¶”ê°€)
src/pages/MyPage/components/modals/ChangePasswordModal.tsx
src/services/authService.ts
```

---

## 3. API ìŠ¤í™

### 3.1 ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ë¡œê·¸ì¸ ìƒíƒœ) - ì´ì¤‘ ì¸ì¦

#### Step 1: í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
```
POST /api/auth/verify-password
Authorization: Bearer {accessToken}
Rate Limit: 10 req/min per (IP + username) âš¡ v3 ì¶”ê°€
```
**Request**
```json
{
  "currentPassword": "í˜„ì¬ë¹„ë°€ë²ˆí˜¸"
}
```
**Response** (v3 ë³€ê²½: ëª¨ë“  ì¼€ì´ìŠ¤ 200 OK)
```json
{
  "success": true,
  "data": {
    "verified": true,
    "message": "ë¹„ë°€ë²ˆí˜¸ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤."
  }
}
```
**ì‹¤íŒ¨ ì‹œ** (v3: HTTP 401/400 â†’ 200 OKë¡œ í†µì¼)
```json
{
  "success": false,
  "error": {
    "message": "ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤"
  }
}
```

#### Step 2: ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ ë°œì†¡
```
POST /api/auth/email/send-change-code
Authorization: Bearer {accessToken}
```
**Request**
```json
{
  "email": "user@example.com"
}
```

#### Step 3: ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
```
PUT /api/mypage/password
Authorization: Bearer {accessToken}
```
**Request** (v3: ChangePasswordRequest ì‚¬ìš©)
```json
{
  "code": "123456",
  "newPassword": "NewPass123!"
}
```
**Response**
```json
{
  "success": true,
  "data": {
    "message": "ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤."
  }
}
```

### 3.2 ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° (ë¹„ë¡œê·¸ì¸ ìƒíƒœ)

#### Step 1: ì¸ì¦ ì½”ë“œ ë°œì†¡
```
POST /api/auth/email/send-reset-code
```
**Request**
```json
{
  "email": "user@example.com"
}
```

#### Step 2: ì¸ì¦ ì½”ë“œ í™•ì¸
```
POST /api/auth/email/verify-reset
```
**Request**
```json
{
  "email": "user@example.com",
  "code": "123456"
}
```

#### Step 3: ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •
```
POST /api/auth/reset-password
```
**Request**
```json
{
  "email": "user@example.com",
  "code": "123456",
  "newPassword": "NewPass123!"
}
```

---

## 4. ì¸ì¦ íƒ€ì… êµ¬ë¶„

| íƒ€ì… | ìš©ë„ | ë°œì†¡ API | ê²€ì¦ ë©”ì„œë“œ |
|------|------|----------|-------------|
| `SIGNUP` | íšŒì›ê°€ì… ì´ë©”ì¼ ì¸ì¦ | send-verification | verifyCode() |
| `PASSWORD_RESET` | ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° (ë¹„ë¡œê·¸ì¸) | send-reset-code | verifyResetCode() |
| `PASSWORD_CHANGE` | ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ë¡œê·¸ì¸) | send-change-code | verifyChangeCode() |

---

## 5. íë¦„ë„

### 5.1 ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ë¡œê·¸ì¸ ìƒíƒœ)
```
[ë§ˆì´í˜ì´ì§€]                         [ë°±ì—”ë“œ]
     â”‚
     â”‚ 1. í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST /api/auth/verify-password
     â”‚                                âœ“ ë³¸ì¸ í™•ì¸
     â”‚
     â”‚ 2. "ì´ë©”ì¼ ì¸ì¦" í´ë¦­
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST /api/auth/email/send-change-code
     â”‚                                â†’ ì´ë©”ì¼ë¡œ 6ìë¦¬ ì½”ë“œ ë°œì†¡
     â”‚
     â”‚ 3. ì¸ì¦ì½”ë“œ + ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º PUT /api/mypage/password
     â”‚                                âœ“ PASSWORD_CHANGE íƒ€ì… ê²€ì¦
     â”‚                                âœ“ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
     â”‚
     â”‚ 4. 200 OK (ì™„ë£Œ)
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

### 5.2 ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° (ë¹„ë¡œê·¸ì¸ ìƒíƒœ)
```
[ë¡œê·¸ì¸ í˜ì´ì§€]                       [ë°±ì—”ë“œ]
     â”‚
     â”‚ 1. ì´ë©”ì¼ ì…ë ¥
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST /api/auth/email/send-reset-code
     â”‚                                â†’ ì´ë©”ì¼ë¡œ 6ìë¦¬ ì½”ë“œ ë°œì†¡
     â”‚
     â”‚ 2. ì¸ì¦ ì½”ë“œ ì…ë ¥
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST /api/auth/email/verify-reset
     â”‚                                âœ“ PASSWORD_RESET íƒ€ì… ê²€ì¦
     â”‚
     â”‚ 3. ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST /api/auth/reset-password
     â”‚                                âœ“ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •
     â”‚
     â”‚ 4. 200 OK â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

---

## 6. ë³´ì•ˆ ì •ì±…

| í•­ëª© | ì •ì±… | v3 ì¶”ê°€ ì‚¬í•­ |
|------|------|--------------|
| ì¸ì¦ ì½”ë“œ ìœ íš¨ ì‹œê°„ | 3ë¶„ | - |
| ì¸ì¦ ì‹œë„ ì œí•œ | 5íšŒ ì‹¤íŒ¨ ì‹œ 30ë¶„ ì°¨ë‹¨ | - |
| ë¹„ë°€ë²ˆí˜¸ ê·œì¹™ | 8~20ì, ì˜ë¬¸+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ì í•„ìˆ˜ | - |
| ì½”ë“œ ì¬ë°œì†¡ | ì´ì „ ì½”ë“œ ë¬´íš¨í™” | - |
| **Rate Limiting** | - | **âœ… ì „ì—­: 100 req/min per IP** |
| **ë¹„ë°€ë²ˆí˜¸ ê²€ì¦** | - | **âœ… 10 req/min per (IP + username)** |
| **ë¡œê·¸ì¸** | - | **âœ… 5 req/min per IP** |
| **ì •ë³´ ëˆ„ì¶œ ë°©ì§€** | - | **âœ… ì‘ë‹µ í†µì¼ (200 OK + failure)** |
| **ìŠ¹ì¸ ìƒíƒœ ìˆ¨ê¹€** | - | **âœ… ì¼ê´€ëœ ë©”ì‹œì§€** |

### v3 ë³´ì•ˆ ê°•í™” ì„¸ë¶€ ì‚¬í•­

#### Rate Limiting (Redis ê¸°ë°˜)
- **êµ¬í˜„**: `RateLimitFilter.java`
- **Redis Lua Script**: ì›ìì  INCR + EXPIRE ì—°ì‚°
- **ë‹¤ì¸µ ë°©ì–´**: ì „ì—­ â†’ ë¡œê·¸ì¸ â†’ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
- **ë¶„ì‚° í™˜ê²½**: ì—¬ëŸ¬ ì„œë²„ì—ì„œë„ ì •í™•í•œ ì œí•œ

#### ì •ë³´ ëˆ„ì¶œ ë°©ì§€
- **HTTP ìƒíƒœ ì½”ë“œ í†µì¼**: 401/400 â†’ 200 OK
- **ì—ëŸ¬ ë©”ì‹œì§€ í†µì¼**: "ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤"
- **íƒ€ì´ë° ê³µê²© ì™„í™”**: ëª¨ë“  ì‹¤íŒ¨ ê²½ë¡œ ë™ì¼í•œ ì‘ë‹µ ì‹œê°„

---

## 7. í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€

### 7.1 ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° í˜ì´ì§€
- **ê²½ë¡œ**: `/forgot-password`
- **ì»´í¬ë„ŒíŠ¸**: `ForgotPasswordPage.tsx`
- **ë‹¨ê³„**:
  1. ì´ë©”ì¼ ì…ë ¥ â†’ ì¸ì¦ ì½”ë“œ ë°œì†¡
  2. ì¸ì¦ ì½”ë“œ ì…ë ¥ â†’ í™•ì¸
  3. ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
  4. ì™„ë£Œ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™

### 7.2 ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ëª¨ë‹¬ (ë§ˆì´í˜ì´ì§€)
- **ì»´í¬ë„ŒíŠ¸**: `ChangePasswordModal.tsx`
- **ë‹¨ê³„**:
  1. í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ â†’ "ì´ë©”ì¼ ì¸ì¦" ë²„íŠ¼
  2. ì¸ì¦ ì½”ë“œ ì…ë ¥
  3. ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
  4. ì™„ë£Œ

---

## 8. ì™„ë£Œ ìƒíƒœ

### v2 (2025-11-29 ~ 11-30)
- âœ… ë°±ì—”ë“œ API êµ¬í˜„
- âœ… í”„ë¡ íŠ¸ì—”ë“œ UI êµ¬í˜„
- âœ… ì´ë©”ì¼ í…œí”Œë¦¿ ì‘ì„±
- âœ… ë¼ìš°íŒ… ì„¤ì •
- âœ… ì»´íŒŒì¼ ì„±ê³µ
- âœ… ê¸°ë³¸ í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ

### v3 (2025-12-01) - ë³´ì•ˆ ê°•í™”
- âœ… Rate Limiting êµ¬í˜„ (Redis + Lua Script)
- âœ… ì •ë³´ ëˆ„ì¶œ ë°©ì§€ (ì‘ë‹µ í†µì¼)
- âœ… API ê³„ì•½ ë³µì› (ChangePasswordRequest)
- âœ… Soft Delete ì •ì±… ì¼ê´€ì„± ìœ ì§€
- âœ… ì½”ë“œ í’ˆì§ˆ ê°œì„  (Enum ì§ì ‘ ë¹„êµ)
- âœ… í…ŒìŠ¤íŠ¸ Mock ìˆ˜ì • (Repository ê³„ì•½ ì¤€ìˆ˜)
- âœ… ë¬¸ì„œí™” ì™„ë£Œ (10ê°œ íŒŒì¼ ì—…ë°ì´íŠ¸)

---

## 9. ê´€ë ¨ ì»¤ë°‹ (v3)

```bash
cb047ff - docs: Update documentation for Soft Delete policy and security improvements
49d982e - fix: Correct soft-deleted account test mock
5e5c9ef - fix: Restore changePassword to use ChangePasswordRequest
d8dd552 - fix: Remove duplicate PATCH /password endpoint
36ac731 - refactor: Use direct enum comparison instead of string comparison
9b2a4bf - fix: Prevent approval status disclosure in login
303fb42 - fix: Allow email reuse after soft delete
e284efe - fix: Allow phone number reuse after soft delete
3e4bd30 - fix: Prevent information disclosure in password verification
075ce17 - refactor: Extend Redis-based RateLimitFilter instead of Bucket4j
e3370a9 - feat: Add rate limiting for password verification and login
```

---

## 10. ë‹¤ìŒ ì‘ì—… (ì„ íƒì‚¬í•­)

- [ ] Rate Limiting í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] ë¹„ë°€ë²ˆí˜¸ ì •ì±… ê°•í™” (íˆìŠ¤í† ë¦¬, ë§Œë£Œ)
- [ ] ê³„ì • ì ê¸ˆ ì •ì±… (ì—°ì† ë¡œê·¸ì¸ ì‹¤íŒ¨)
- [ ] 2FA (Two-Factor Authentication) ë„ì… ê²€í† 
- [ ] API ë¬¸ì„œ ì—…ë°ì´íŠ¸ (Swagger/OpenAPI)
- [ ] ë³´ì•ˆ ì´ë²¤íŠ¸ ëª¨ë‹ˆí„°ë§ ì„¤ì •

---

**ì‘ì„±ì**: GitHub Copilot  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-01  
**ë¸Œëœì¹˜**: account-update-v3
