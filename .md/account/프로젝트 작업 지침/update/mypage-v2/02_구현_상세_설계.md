# ë§ˆì´í˜ì´ì§€ í™œë™ ë‚´ì—­ API êµ¬í˜„ ìƒì„¸ ì„¤ê³„

## ğŸ“‹ ê°œìš”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì‘ì„±ì¼** | 2025-12-02 |
| **ê²°ì •ì‚¬í•­** | ë…¼ì˜ ê²°ê³¼ ë°˜ì˜ |

---

## âœ… ìµœì¢… ê²°ì • ì‚¬í•­

| ë…¼ì˜ í¬ì¸íŠ¸ | ê²°ì • |
|------------|------|
| ì°œí•œ ê°•ì¢Œ | ê¸°ì¡´ `/api/courses/favorites` ì¬ì‚¬ìš© |
| API ìœ„ì¹˜ | `MyPageController`ì— ì¶”ê°€ |
| í™œë™ í†µê³„ | ë³„ë„ API (`/api/mypage/stats`) ìƒì„± |
| ì‚­ì œëœ ë°ì´í„° | ì œì™¸ (`isDeleted = false`) |
| í˜ì´ì§€ë„¤ì´ì…˜ | ê¸€/ëŒ“ê¸€ì— ì ìš© |

---

## ğŸ—ï¸ êµ¬í˜„ ëŒ€ìƒ API (3ê°œ)

| # | API | ì„¤ëª… |
|---|-----|------|
| 1 | `GET /api/mypage/posts` | ë‚´ê°€ ì“´ ê¸€ ëª©ë¡ |
| 2 | `GET /api/mypage/comments` | ë‚´ê°€ ì“´ ëŒ“ê¸€ ëª©ë¡ |
| 3 | `GET /api/mypage/stats` | í™œë™ í†µê³„ |

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

### ì‹ ê·œ ìƒì„± íŒŒì¼
```
src/main/java/com/softwarecampus/backend/
â””â”€â”€ dto/
    â””â”€â”€ mypage/
        â”œâ”€â”€ MyPostResponseDTO.java         # ë‚´ê°€ ì“´ ê¸€ DTO
        â”œâ”€â”€ MyCommentResponseDTO.java      # ë‚´ê°€ ì“´ ëŒ“ê¸€ DTO
        â””â”€â”€ MyStatsResponseDTO.java        # í™œë™ í†µê³„ DTO
```

### ìˆ˜ì • íŒŒì¼
```
src/main/java/com/softwarecampus/backend/
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ user/
â”‚       â””â”€â”€ MyPageController.java          # ì—”ë“œí¬ì¸íŠ¸ 3ê°œ ì¶”ê°€
â”œâ”€â”€ service/
â”‚   â””â”€â”€ user/
â”‚       â”œâ”€â”€ MyPageService.java             # ì¸í„°í˜ì´ìŠ¤ ë©”ì„œë“œ 3ê°œ ì¶”ê°€
â”‚       â””â”€â”€ MyPageServiceImpl.java         # êµ¬í˜„ 3ê°œ ì¶”ê°€
â””â”€â”€ repository/
    â””â”€â”€ board/
        â”œâ”€â”€ BoardRepository.java           # ì¿¼ë¦¬ 1ê°œ ì¶”ê°€
        â””â”€â”€ CommentRepository.java         # ì¿¼ë¦¬ 1ê°œ ì¶”ê°€
```

---

## 1ï¸âƒ£ ë‚´ê°€ ì“´ ê¸€ ëª©ë¡ API

### Endpoint
```
GET /api/mypage/posts?page=0&size=10&sort=createdAt,desc
```

### Request
| íŒŒë¼ë¯¸í„° | íƒ€ì… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|---------|------|-----|--------|------|
| page | int | X | 0 | í˜ì´ì§€ ë²ˆí˜¸ (0-indexed) |
| size | int | X | 10 | í˜ì´ì§€ í¬ê¸° |
| sort | string | X | createdAt,desc | ì •ë ¬ |

### Response
```json
{
  "content": [
    {
      "id": 101,
      "title": "React 19 ìƒˆë¡œìš´ ê¸°ëŠ¥ ì •ë¦¬",
      "category": "CODING_STORY",
      "hits": 245,
      "commentsCount": 12,
      "likeCount": 5,
      "createdAt": "2025-01-15T10:30:00"
    }
  ],
  "totalElements": 15,
  "totalPages": 2,
  "number": 0,
  "size": 10
}
```

### DTO ì„¤ê³„
```java
@Getter
@Builder
public class MyPostResponseDTO {
    private Long id;
    private String title;
    private BoardCategory category;
    private Long hits;
    private Long commentsCount;
    private Long likeCount;
    private LocalDateTime createdAt;
}
```

### Repository ì¿¼ë¦¬
```java
// BoardRepository.java
@Query("""
    SELECT new com.softwarecampus.backend.dto.mypage.MyPostResponseDTO(
        b.id, b.title, b.category, b.hits,
        (SELECT COUNT(c) FROM Comment c WHERE c.board = b AND c.isDeleted = false),
        (SELECT COUNT(r) FROM BoardRecommend r WHERE r.board = b),
        b.createdAt
    )
    FROM Board b
    WHERE b.account.id = :accountId AND b.isDeleted = false
    ORDER BY b.createdAt DESC
    """)
Page<MyPostResponseDTO> findMyPosts(@Param("accountId") Long accountId, Pageable pageable);
```

### Service ë¡œì§
```java
// MyPageServiceImpl.java
@Transactional(readOnly = true)
public Page<MyPostResponseDTO> getMyPosts(Long accountId, Pageable pageable) {
    return boardRepository.findMyPosts(accountId, pageable);
}
```

### Controller
```java
// MyPageController.java
@GetMapping("/posts")
@PreAuthorize("isAuthenticated()")
public ResponseEntity<Page<MyPostResponseDTO>> getMyPosts(
        @AuthenticationPrincipal CustomUserDetails userDetails,
        Pageable pageable) {
    return ResponseEntity.ok(myPageService.getMyPosts(userDetails.getId(), pageable));
}
```

---

## 2ï¸âƒ£ ë‚´ê°€ ì“´ ëŒ“ê¸€ ëª©ë¡ API

### Endpoint
```
GET /api/mypage/comments?page=0&size=10&sort=createdAt,desc
```

### Request
| íŒŒë¼ë¯¸í„° | íƒ€ì… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|---------|------|-----|--------|------|
| page | int | X | 0 | í˜ì´ì§€ ë²ˆí˜¸ |
| size | int | X | 10 | í˜ì´ì§€ í¬ê¸° |
| sort | string | X | createdAt,desc | ì •ë ¬ |

### Response
```json
{
  "content": [
    {
      "id": 501,
      "text": "ì €ë„ ê°™ì€ ìƒê°ì…ë‹ˆë‹¤!",
      "boardId": 101,
      "boardTitle": "React 19 ìƒˆë¡œìš´ ê¸°ëŠ¥ ì •ë¦¬",
      "createdAt": "2025-01-15T11:00:00"
    }
  ],
  "totalElements": 42,
  "totalPages": 5,
  "number": 0,
  "size": 10
}
```

### DTO ì„¤ê³„
```java
@Getter
@Builder
public class MyCommentResponseDTO {
    private Long id;
    private String text;
    private Long boardId;
    private String boardTitle;
    private LocalDateTime createdAt;
}
```

### Repository ì¿¼ë¦¬
```java
// CommentRepository.java
@Query("""
    SELECT new com.softwarecampus.backend.dto.mypage.MyCommentResponseDTO(
        c.id, c.text, c.board.id, c.board.title, c.createdAt
    )
    FROM Comment c
    WHERE c.account.id = :accountId 
      AND c.isDeleted = false 
      AND c.board.isDeleted = false
    ORDER BY c.createdAt DESC
    """)
Page<MyCommentResponseDTO> findMyComments(@Param("accountId") Long accountId, Pageable pageable);
```

### Service ë¡œì§
```java
@Transactional(readOnly = true)
public Page<MyCommentResponseDTO> getMyComments(Long accountId, Pageable pageable) {
    return commentRepository.findMyComments(accountId, pageable);
}
```

### Controller
```java
@GetMapping("/comments")
@PreAuthorize("isAuthenticated()")
public ResponseEntity<Page<MyCommentResponseDTO>> getMyComments(
        @AuthenticationPrincipal CustomUserDetails userDetails,
        Pageable pageable) {
    return ResponseEntity.ok(myPageService.getMyComments(userDetails.getId(), pageable));
}
```

---

## 3ï¸âƒ£ í™œë™ í†µê³„ API

### Endpoint
```
GET /api/mypage/stats
```

### Response
```json
{
  "totalPosts": 15,
  "totalComments": 42,
  "totalBookmarks": 8,
  "totalViews": 1250
}
```

### DTO ì„¤ê³„
```java
@Getter
@Builder
@AllArgsConstructor
public class MyStatsResponseDTO {
    private Long totalPosts;      // ì‘ì„±í•œ ê¸€ ìˆ˜
    private Long totalComments;   // ì‘ì„±í•œ ëŒ“ê¸€ ìˆ˜
    private Long totalBookmarks;  // ì°œí•œ ê°•ì¢Œ ìˆ˜
    private Long totalViews;      // ì´ ì¡°íšŒìˆ˜ (ë‚´ ê¸€ë“¤ì˜ hits í•©ê³„)
}
```

### Repository ì¿¼ë¦¬ (Countìš©)
```java
// BoardRepository.java
@Query("SELECT COUNT(b) FROM Board b WHERE b.account.id = :accountId AND b.isDeleted = false")
Long countByAccountId(@Param("accountId") Long accountId);

@Query("SELECT COALESCE(SUM(b.hits), 0) FROM Board b WHERE b.account.id = :accountId AND b.isDeleted = false")
Long sumHitsByAccountId(@Param("accountId") Long accountId);

// CommentRepository.java
@Query("SELECT COUNT(c) FROM Comment c WHERE c.account.id = :accountId AND c.isDeleted = false")
Long countByAccountId(@Param("accountId") Long accountId);

// CourseFavoriteRepository.java (ê¸°ì¡´ì— ìˆì„ ìˆ˜ ìˆìŒ)
@Query("SELECT COUNT(f) FROM CourseFavorite f WHERE f.account.id = :accountId")
Long countByAccountId(@Param("accountId") Long accountId);
```

### Service ë¡œì§
```java
@Transactional(readOnly = true)
public MyStatsResponseDTO getMyStats(Long accountId) {
    Long totalPosts = boardRepository.countByAccountId(accountId);
    Long totalComments = commentRepository.countByAccountId(accountId);
    Long totalBookmarks = courseFavoriteRepository.countByAccountId(accountId);
    Long totalViews = boardRepository.sumHitsByAccountId(accountId);
    
    return MyStatsResponseDTO.builder()
            .totalPosts(totalPosts)
            .totalComments(totalComments)
            .totalBookmarks(totalBookmarks)
            .totalViews(totalViews)
            .build();
}
```

### Controller
```java
@GetMapping("/stats")
@PreAuthorize("isAuthenticated()")
public ResponseEntity<MyStatsResponseDTO> getMyStats(
        @AuthenticationPrincipal CustomUserDetails userDetails) {
    return ResponseEntity.ok(myPageService.getMyStats(userDetails.getId()));
}
```

---

## ğŸ”„ êµ¬í˜„ ìˆœì„œ

### Step 1: DTO ìƒì„± (3ê°œ íŒŒì¼)
```
dto/mypage/
â”œâ”€â”€ MyPostResponseDTO.java
â”œâ”€â”€ MyCommentResponseDTO.java
â””â”€â”€ MyStatsResponseDTO.java
```

### Step 2: Repository ì¿¼ë¦¬ ì¶”ê°€
```
BoardRepository.java
â”œâ”€â”€ findMyPosts()
â”œâ”€â”€ countByAccountId()
â””â”€â”€ sumHitsByAccountId()

CommentRepository.java
â”œâ”€â”€ findMyComments()
â””â”€â”€ countByAccountId()

CourseFavoriteRepository.java
â””â”€â”€ countByAccountId() (í™•ì¸ í•„ìš”)
```

### Step 3: Service ë©”ì„œë“œ ì¶”ê°€
```
MyPageService.java (ì¸í„°í˜ì´ìŠ¤)
â”œâ”€â”€ getMyPosts()
â”œâ”€â”€ getMyComments()
â””â”€â”€ getMyStats()

MyPageServiceImpl.java (êµ¬í˜„)
â”œâ”€â”€ getMyPosts()
â”œâ”€â”€ getMyComments()
â””â”€â”€ getMyStats()
```

### Step 4: Controller ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
```
MyPageController.java
â”œâ”€â”€ GET /api/mypage/posts
â”œâ”€â”€ GET /api/mypage/comments
â””â”€â”€ GET /api/mypage/stats
```

### Step 5: í…ŒìŠ¤íŠ¸
- Postman ë˜ëŠ” curlë¡œ ê° API í…ŒìŠ¤íŠ¸
- í˜ì´ì§€ë„¤ì´ì…˜ ë™ì‘ í™•ì¸
- ë¹ˆ ë°ì´í„° ì‘ë‹µ í™•ì¸

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ì‚­ì œëœ ë°ì´í„° í•„í„°ë§
```java
// ë°˜ë“œì‹œ isDeleted = false ì¡°ê±´ ì¶”ê°€
WHERE b.isDeleted = false
WHERE c.isDeleted = false AND c.board.isDeleted = false
```

### 2. ì¸ì¦ í•„ìˆ˜
```java
// ëª¨ë“  APIì— ì¸ì¦ í•„ìš”
@PreAuthorize("isAuthenticated()")
```

### 3. N+1 ë¬¸ì œ ë°©ì§€
- JPQLì—ì„œ ì§ì ‘ DTO ìƒì„± (`SELECT new DTO(...)`)
- ì„œë¸Œì¿¼ë¦¬ë¡œ count ì²˜ë¦¬

### 4. í˜ì´ì§€ë„¤ì´ì…˜ ì¼ê´€ì„±
- í”„ë¡ íŠ¸ì—”ë“œ: page 0-indexed
- Spring Data JPA: page 0-indexed (ì¼ì¹˜)

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### DTO
- [ ] `MyPostResponseDTO.java` ìƒì„±
- [ ] `MyCommentResponseDTO.java` ìƒì„±
- [ ] `MyStatsResponseDTO.java` ìƒì„±

### Repository
- [ ] `BoardRepository.findMyPosts()` ì¶”ê°€
- [ ] `BoardRepository.countByAccountId()` ì¶”ê°€
- [ ] `BoardRepository.sumHitsByAccountId()` ì¶”ê°€
- [ ] `CommentRepository.findMyComments()` ì¶”ê°€
- [ ] `CommentRepository.countByAccountId()` ì¶”ê°€
- [ ] `CourseFavoriteRepository.countByAccountId()` í™•ì¸/ì¶”ê°€

### Service
- [ ] `MyPageService` ì¸í„°í˜ì´ìŠ¤ ë©”ì„œë“œ 3ê°œ ì¶”ê°€
- [ ] `MyPageServiceImpl` êµ¬í˜„ 3ê°œ ì¶”ê°€

### Controller
- [ ] `GET /api/mypage/posts` ì¶”ê°€
- [ ] `GET /api/mypage/comments` ì¶”ê°€
- [ ] `GET /api/mypage/stats` ì¶”ê°€

### í…ŒìŠ¤íŠ¸
- [ ] ë‚´ê°€ ì“´ ê¸€ API í…ŒìŠ¤íŠ¸
- [ ] ë‚´ê°€ ì“´ ëŒ“ê¸€ API í…ŒìŠ¤íŠ¸
- [ ] í™œë™ í†µê³„ API í…ŒìŠ¤íŠ¸
- [ ] ë¹ˆ ë°ì´í„° ì‘ë‹µ í…ŒìŠ¤íŠ¸
- [ ] ì¸ì¦ ì—†ì´ ì ‘ê·¼ ì‹œ 401 í™•ì¸

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- êµ¬í˜„ ê³„íš: `01_ë§ˆì´í˜ì´ì§€_í™œë™ë‚´ì—­_API_êµ¬í˜„ê³„íš.md`
- í”„ë¡ íŠ¸ì—”ë“œ Mock ë°ì´í„°: `softwarecampus-frontend/docs/account/mypage/01_Mock_ë°ì´í„°_í˜„í™©.md`
