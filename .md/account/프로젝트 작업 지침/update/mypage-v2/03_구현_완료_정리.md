# ë§ˆì´í˜ì´ì§€ í™œë™ ë‚´ì—­ API êµ¬í˜„ ì™„ë£Œ ë³´ê³ ì„œ

## ğŸ“… ì‘ì—… ì •ë³´
- **ì‘ì—…ì¼**: 2025ë…„ 12ì›” 2ì¼
- **ë¸Œëœì¹˜**: `mypage-community-update`
- **ì‘ì—…ì**: GitHub Copilot

---

## ğŸ“‹ êµ¬í˜„ ìš”ì•½

ë§ˆì´í˜ì´ì§€ì—ì„œ ì‚¬ìš©í•˜ë˜ Mock ë°ì´í„°ë¥¼ ëŒ€ì²´í•˜ê¸° ìœ„í•œ ë°±ì—”ë“œ APIë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

### êµ¬í˜„ëœ API ëª©ë¡

| API Endpoint | Method | ì„¤ëª… | ìƒíƒœ |
|--------------|--------|------|------|
| `/api/mypage/posts` | GET | ë‚´ê°€ ì“´ ê¸€ ëª©ë¡ | âœ… ì‹ ê·œ êµ¬í˜„ |
| `/api/mypage/comments` | GET | ë‚´ê°€ ì“´ ëŒ“ê¸€ ëª©ë¡ | âœ… ì‹ ê·œ êµ¬í˜„ |
| `/api/mypage/stats` | GET | í™œë™ í†µê³„ | âœ… ì‹ ê·œ êµ¬í˜„ |
| `/api/courses/favorites` | GET | ì°œí•œ ê°•ì¢Œ ëª©ë¡ | âœ… ê¸°ì¡´ API ì¬ì‚¬ìš© |

---

## ğŸ“ ìƒì„±/ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

### ğŸ†• ì‹ ê·œ ìƒì„± íŒŒì¼

#### 1. DTO íŒŒì¼ë“¤ (`dto/mypage/`)

**MyPostResponseDTO.java**
```java
public record MyPostResponseDTO(
    Long id,
    String title,
    String category,
    int hits,
    int commentsCount,
    int likeCount,
    LocalDateTime createdAt
) {}
```

**MyCommentResponseDTO.java**
```java
public record MyCommentResponseDTO(
    Long id,
    String text,
    Long boardId,
    String boardTitle,
    LocalDateTime createdAt
) {}
```

**MyStatsResponseDTO.java**
```java
public record MyStatsResponseDTO(
    int totalPosts,
    int totalComments,
    int totalBookmarks,
    int totalViews
) {}
```

### âœï¸ ìˆ˜ì •ëœ íŒŒì¼

#### 2. Repository ìˆ˜ì •

**BoardRepository.java**
```java
// ì¶”ê°€ëœ ë©”ì„œë“œ
@Query("SELECT new com.kosta.softcampus.dto.mypage.MyPostResponseDTO(...) FROM Board b WHERE b.account.id = :accountId")
Page<MyPostResponseDTO> findMyPosts(@Param("accountId") Long accountId, Pageable pageable);

@Query("SELECT COUNT(b) FROM Board b WHERE b.account.id = :accountId")
int countByAccountId(@Param("accountId") Long accountId);

@Query("SELECT COALESCE(SUM(b.hit), 0) FROM Board b WHERE b.account.id = :accountId")
int sumHitsByAccountId(@Param("accountId") Long accountId);
```

**CommentRepository.java**
```java
// ì¶”ê°€ëœ ë©”ì„œë“œ
@Query("SELECT new com.kosta.softcampus.dto.mypage.MyCommentResponseDTO(...) FROM Comment c WHERE c.account.id = :accountId")
Page<MyCommentResponseDTO> findMyComments(@Param("accountId") Long accountId, Pageable pageable);

@Query("SELECT COUNT(c) FROM Comment c WHERE c.account.id = :accountId")
int countByAccountId(@Param("accountId") Long accountId);
```

**CourseFavoriteRepository.java**
```java
// ì¶”ê°€ëœ ë©”ì„œë“œ
int countByAccount_Id(Long accountId);
```

#### 3. Service ìˆ˜ì •

**ProfileService.java** (ì¸í„°í˜ì´ìŠ¤)
```java
// ì¶”ê°€ëœ ë©”ì„œë“œ
Page<MyPostResponseDTO> getMyPosts(Long accountId, int page, int size);
Page<MyCommentResponseDTO> getMyComments(Long accountId, int page, int size);
MyStatsResponseDTO getMyStats(Long accountId);
```

**ProfileServiceImpl.java** (êµ¬í˜„ì²´)
```java
@Override
public Page<MyPostResponseDTO> getMyPosts(Long accountId, int page, int size) {
    Pageable pageable = PageRequest.of(page, size, Sort.by(Sort.Direction.DESC, "createdAt"));
    return boardRepository.findMyPosts(accountId, pageable);
}

@Override
public Page<MyCommentResponseDTO> getMyComments(Long accountId, int page, int size) {
    Pageable pageable = PageRequest.of(page, size, Sort.by(Sort.Direction.DESC, "createdAt"));
    return commentRepository.findMyComments(accountId, pageable);
}

@Override
public MyStatsResponseDTO getMyStats(Long accountId) {
    int totalPosts = boardRepository.countByAccountId(accountId);
    int totalComments = commentRepository.countByAccountId(accountId);
    int totalBookmarks = courseFavoriteRepository.countByAccount_Id(accountId);
    int totalViews = boardRepository.sumHitsByAccountId(accountId);
    return new MyStatsResponseDTO(totalPosts, totalComments, totalBookmarks, totalViews);
}
```

#### 4. Controller ìˆ˜ì •

**MyPageController.java**
```java
// ì¶”ê°€ëœ ì—”ë“œí¬ì¸íŠ¸

@GetMapping("/posts")
public ResponseEntity<Page<MyPostResponseDTO>> getMyPosts(
        @AuthenticationPrincipal CustomUserDetails userDetails,
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {
    Long accountId = userDetails.getAccount().getId();
    return ResponseEntity.ok(profileService.getMyPosts(accountId, page, size));
}

@GetMapping("/comments")
public ResponseEntity<Page<MyCommentResponseDTO>> getMyComments(
        @AuthenticationPrincipal CustomUserDetails userDetails,
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {
    Long accountId = userDetails.getAccount().getId();
    return ResponseEntity.ok(profileService.getMyComments(accountId, page, size));
}

@GetMapping("/stats")
public ResponseEntity<MyStatsResponseDTO> getMyStats(
        @AuthenticationPrincipal CustomUserDetails userDetails) {
    Long accountId = userDetails.getAccount().getId();
    return ResponseEntity.ok(profileService.getMyStats(accountId));
}
```

---

## ğŸ”— API ìƒì„¸ ëª…ì„¸

### 1. ë‚´ê°€ ì“´ ê¸€ ëª©ë¡
```
GET /api/mypage/posts?page=0&size=10
Authorization: Bearer {token}
```

**Response:**
```json
{
  "content": [
    {
      "id": 1,
      "title": "ê²Œì‹œê¸€ ì œëª©",
      "category": "ììœ ê²Œì‹œíŒ",
      "hits": 150,
      "commentsCount": 5,
      "likeCount": 10,
      "createdAt": "2025-12-01T10:30:00"
    }
  ],
  "totalElements": 25,
  "totalPages": 3,
  "number": 0,
  "size": 10
}
```

### 2. ë‚´ê°€ ì“´ ëŒ“ê¸€ ëª©ë¡
```
GET /api/mypage/comments?page=0&size=10
Authorization: Bearer {token}
```

**Response:**
```json
{
  "content": [
    {
      "id": 1,
      "text": "ëŒ“ê¸€ ë‚´ìš©",
      "boardId": 5,
      "boardTitle": "ì›ê¸€ ì œëª©",
      "createdAt": "2025-12-01T14:20:00"
    }
  ],
  "totalElements": 15,
  "totalPages": 2,
  "number": 0,
  "size": 10
}
```

### 3. í™œë™ í†µê³„
```
GET /api/mypage/stats
Authorization: Bearer {token}
```

**Response:**
```json
{
  "totalPosts": 25,
  "totalComments": 48,
  "totalBookmarks": 12,
  "totalViews": 1500
}
```

### 4. ì°œí•œ ê°•ì¢Œ ëª©ë¡ (ê¸°ì¡´ API)
```
GET /api/courses/favorites
Authorization: Bearer {token}
```

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] DTO 3ê°œ ìƒì„± ì™„ë£Œ
- [x] Repository ì¿¼ë¦¬ ì¶”ê°€ ì™„ë£Œ
- [x] Service ì¸í„°í˜ì´ìŠ¤ ë° êµ¬í˜„ì²´ ìˆ˜ì • ì™„ë£Œ
- [x] Controller ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ ì™„ë£Œ
- [x] ì»´íŒŒì¼ ì—ëŸ¬ ì—†ìŒ í™•ì¸
- [x] ì°œí•œ ê°•ì¢Œ API ê¸°ì¡´ ì¬ì‚¬ìš© í™•ì¸

---

## ğŸ”œ ë‹¤ìŒ ë‹¨ê³„: í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™

### ìˆ˜ì • í•„ìš” íŒŒì¼
- `softwarecampus-frontend/src/pages/MyPage.tsx`

### ë³€ê²½ ì‚¬í•­
1. Mock ë°ì´í„° import ì œê±°
2. API í˜¸ì¶œ í•¨ìˆ˜ ì¶”ê°€ (axios/fetch)
3. useEffectë¡œ ë°ì´í„° ë¡œë“œ
4. ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œë”© ìƒíƒœ ê´€ë¦¬

### API í˜¸ì¶œ ì˜ˆì‹œ
```typescript
// services/myPageService.ts
export const getMyPosts = (page = 0, size = 10) => 
  api.get(`/api/mypage/posts?page=${page}&size=${size}`);

export const getMyComments = (page = 0, size = 10) => 
  api.get(`/api/mypage/comments?page=${page}&size=${size}`);

export const getMyStats = () => 
  api.get('/api/mypage/stats');

export const getFavorites = () => 
  api.get('/api/courses/favorites');
```

---

## ğŸ“ ì°¸ê³ ì‚¬í•­

1. **ì¸ì¦ í•„ìˆ˜**: ëª¨ë“  ë§ˆì´í˜ì´ì§€ APIëŠ” JWT í† í°ì´ í•„ìš”í•©ë‹ˆë‹¤.
2. **í˜ì´ì§€ë„¤ì´ì…˜**: ê¸€/ëŒ“ê¸€ ëª©ë¡ì€ Spring Dataì˜ `Page` ê°ì²´ë¡œ ë°˜í™˜ë©ë‹ˆë‹¤.
3. **ì •ë ¬ ê¸°ë³¸ê°’**: ìƒì„±ì¼ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ìˆœ)
4. **ì°œí•œ ê°•ì¢Œ**: `CourseFavoriteController`ì˜ ê¸°ì¡´ APIë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
