# --------------------------------------------------------------------
## 환경 설정
# 작성일자 : 2025-10-20
# --------------------------------------------------------------------
# 중요한 보안 정보 등은 절대로 소스코드 저장소에 올리지 말고 환경변수로 관리 (.env)
# 로컬 및 서버 배포 시에는 .env 파일에 실제 값들을 작성하여 사용할 것
# application.properties 에서 참조하는 변수는 .env에서 관리할 것
# env 파일은 한 곳에서 관리할 것이며, 절대 저장소에 올리지 말 것 (CI/CD 환경에서 주입받아 사용)
# 아래는 변수명 정도만 알 수 있게. 실제 값은 절대로 소스코드 관리도구에 노출되면 안됨.
# ---------------------------------------------------------------------


# env 파일 불러올 수 있게 설정
# Spring Boot ConfigData 기능을 통해서 외부 변수를 주입받음.
# .env 파일이 현재 디렉터리에 .env.properties로 있다 가정함.
spring.config.import=optional:file:./.env[.properties]


# 서버 포트
server.port=${PORT_NO:8080}

# ----------------------------------------------------------------------
## DB 연결 설정
# 작성일자 :2025-10-20
# 업데이트: 2025-12-01 - SSL/TLS 환경변수 제어 추가
# ----------------------------------------------------------------------

#spring.jpa.database Deprecated 됨 -> Spring이 알아서 처리함.
#spring.jpa.database=${DATABASE_TYPE}
spring.datasource.driver-class-name=${DB_DRIVER}
spring.datasource.url=jdbc:mysql://${DB_URL}/${DB_NAME}?serverTimezone=${TZ}&useSSL=${DB_USE_SSL:true}&allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=${DB_CHARACTER_ENCODING}&connectionCollation=${DB_MYSQL_COLLATION_SERVER}
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWORD}

# JPA 설정
spring.jpa.hibernate.ddl-auto=${JPA_DDL_AUTO}
#DDL 실행 순서 자동으로 감지
spring.jpa.properties.hibernate.hbm2ddl.drop_order=true
spring.jpa.show-sql=${JPA_SHOW_SQL}
spring.jpa.open-in-view=${JPA_OPEN_IN_VIEW:false}
spring.datasource.hikari.connectionInitSql=${DB_MYSQL_INIT_CONNECT}

# dialect 자동으로 잡힘 Deprecated됨 -> Spring이 알아서 처리함.
# Warn 메시지 안 나오게 하려면 주석처리 할 것. 두 개 중 하나 쓰면됨. hibernate가 직접 잡을 수 있는 것으로 지정
#spring.jpa.properties.hibernate.dialect=${JPA_DIALECT}
#spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect

#문자셋을 맞춰 주려면 true 설정
spring.jpa.properties.hibernate.connection.useUnicode=true

# ----------------------------------------------------------------------
## 로그 레벨 설정
# 작성일자 :2025-10-20
# ----------------------------------------------------------------------
#log
#logging.level.root=${LOG_LEVEL_ROOT}
#logging.level.org.hibernate.SQL=${LOG_LEVEL_SQL}
#logging.level.org.springframework.orm.jpa.JpaTransactionManager=${LOG_LEVEL_TX}
#logging.level.org.springframework.transaction.interceptor.TransactionInterceptor=${LOG_LEVEL_INTERCEPTOR}

# ----------------------------------------------------------------------
## AWS S3 설정
# 작성일자 :2025-11-19
# 업데이트: 2025-11-19 - DefaultCredentialsProvider 도입
# ----------------------------------------------------------------------
# AWS 인증 정보는 DefaultCredentialsProvider를 통해 자동 조회:
# 1. 환경변수: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY
# 2. ~/.aws/credentials 파일
# 3. IAM Role (EC2/ECS 배포 시)
# 
# 로컬 개발: .env 파일에 AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY 설정
# AWS 배포: IAM Role 사용 (환경변수 불필요)
aws.s3.region=${AWS_REGION:ap-northeast-2}
aws.s3.bucket-name=${AWS_S3_BUCKET_NAME}

# ----------------------------------------------------------------------
## 파일 업로드 보안 설정
# 작성일자 :2025-11-19
# 업데이트: 2025-11-28 - Multipart 크기 제한 명시 및 기관 파일 추가
# ----------------------------------------------------------------------
# Spring Multipart 크기 제한 (기본값 1MB를 50MB로 상향)
# enabled=true는 Spring Boot가 자동 설정하므로 생략 가능
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=100MB

# 파일 타입별 설정 (확장자, MIME 타입, 최대 크기)

# 프로필 이미지 (account 테이블)
file.upload.profile.extensions=${FILE_UPLOAD_PROFILE_EXTENSIONS:jpg,jpeg,png,gif,webp}
file.upload.profile.content-types=${FILE_UPLOAD_PROFILE_CONTENT_TYPES:image/jpeg,image/png,image/gif,image/webp}
file.upload.profile.max-size=${FILE_UPLOAD_PROFILE_MAX_SIZE:5242880}

# 게시판 첨부파일 (board_attach 테이블)
file.upload.board-attach.extensions=${FILE_UPLOAD_BOARD_ATTACH_EXTENSIONS:jpg,jpeg,png,gif,webp,pdf,doc,docx,xls,xlsx,ppt,pptx,txt,md,csv,zip,rar}
file.upload.board-attach.content-types=${FILE_UPLOAD_BOARD_ATTACH_CONTENT_TYPES:image/jpeg,image/png,image/gif,image/webp,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,text/markdown,text/csv,application/zip,application/x-rar-compressed,application/x-zip-compressed}
file.upload.board-attach.max-size=${FILE_UPLOAD_BOARD_ATTACH_MAX_SIZE:52428800}
file.upload.board-attach.max-count=${FILE_UPLOAD_BOARD_ATTACH_MAX_COUNT:5}

# 과정 이미지 (course_image 테이블)
file.upload.course-image.extensions=${FILE_UPLOAD_COURSE_IMAGE_EXTENSIONS:jpg,jpeg,png,gif,webp}
file.upload.course-image.content-types=${FILE_UPLOAD_COURSE_IMAGE_CONTENT_TYPES:image/jpeg,image/png,image/gif,image/webp}
file.upload.course-image.max-size=${FILE_UPLOAD_COURSE_IMAGE_MAX_SIZE:10485760}

# 기관 등록 첨부파일 (academy_files 테이블)
file.upload.academy-file.extensions=${FILE_UPLOAD_ACADEMY_FILE_EXTENSIONS:pdf,jpg,jpeg,png,doc,docx}
file.upload.academy-file.content-types=${FILE_UPLOAD_ACADEMY_FILE_CONTENT_TYPES:application/pdf,image/jpeg,image/png,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document}
file.upload.academy-file.max-size=${FILE_UPLOAD_ACADEMY_FILE_MAX_SIZE:10485760}

# 후기 첨부파일 (course_review_file 테이블) - 수료증 이미지
file.upload.review-file.extensions=${FILE_UPLOAD_REVIEW_FILE_EXTENSIONS:jpg,jpeg,png,pdf}
file.upload.review-file.content-types=${FILE_UPLOAD_REVIEW_FILE_CONTENT_TYPES:image/jpeg,image/png,application/pdf}
file.upload.review-file.max-size=${FILE_UPLOAD_REVIEW_FILE_MAX_SIZE:10485760}

# ----------------------------------------------------------------------
## ProblemDetail API 설정
# 작성일자 :2025-11-19
# ----------------------------------------------------------------------
problem.base-uri=${PROBLEM_BASE_URI}


# ----------------------------------------------------------------------
## Redis 설정
# 작성일자 : 2025-11-25
# 업데이트: 2025-12-01 - Redis 비밀번호 환경변수 추가
# ----------------------------------------------------------------------
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}

# Redis Repository 비활성화 (캐싱과 RedisTemplate만 사용)
spring.data.redis.repositories.enabled=false

# ----------------------------------------------------------------------
## JWT 설정
# 작성일자 : 2025-11-25
# ----------------------------------------------------------------------
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:1800000}

# ----------------------------------------------------------------------
## 인코딩 설정
# 작성일자 : 2025-11-25
# ----------------------------------------------------------------------
# HTTP 및 서블릿 UTF-8 인코딩 설정
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# ----------------------------------------------------------------------
## CORS 설정
# 작성일자 : 2025-11-26
# ----------------------------------------------------------------------
cors.allowed-origins=${ALLOWED_ORIGINS}

# ----------------------------------------------------------------------
## SMTP Email 설정
# 작성일자 : 2025-11-26
# ----------------------------------------------------------------------
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_APP_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000

# Email Verification Settings
email.verification.code-length=6
email.verification.expiry-minutes=3
email.verification.max-attempts=5
email.verification.block-duration-minutes=30
email.verification.resend-cooldown-seconds=60

# ----------------------------------------------------------------------
## Rate Limiting 설정
# 작성일자 : 2025-12-01
# ----------------------------------------------------------------------
# 전역 요청 제한 (IP당)
rate.limit.global.requests-per-minute=${RATE_LIMIT_GLOBAL:100}

# 로그인 요청 제한 (IP당)
rate.limit.login.requests-per-minute=${RATE_LIMIT_LOGIN:5}

# 비밀번호 검증 요청 제한 (IP당)
rate.limit.password-verification.requests-per-minute=${RATE_LIMIT_PASSWORD_VERIFICATION:10}

# Rate Limiting 활성화 여부
rate.limit.enabled=${RATE_LIMIT_ENABLED:true}

# 프록시 헤더 신뢰 여부
# false (기본값): RemoteAddr만 사용 (프록시 없는 환경)
# true: 신뢰할 수 있는 프록시 검증 후 X-Forwarded-For 사용
rate.limit.trust-forwarded-headers=${RATE_LIMIT_TRUST_FORWARDED_HEADERS:false}

# 신뢰할 수 있는 프록시 IP 목록 (쉼표 구분)
# 예시: 10.0.0.1,10.0.0.2,127.0.0.1
# 운영 환경: 실제 Nginx, AWS ALB/ELB 등의 IP 설정
# 로컬/개발: 127.0.0.1 (또는 비워두고 trust-forwarded-headers=false 사용)
rate.limit.trusted-proxies=${RATE_LIMIT_TRUSTED_PROXIES:}
